<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TikTok Downloader by nata~</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,Segoe UI,Roboto}

body{
background:linear-gradient(135deg,#f4faf7,#e8f5ee);
display:flex;justify-content:center;
padding:20px;color:#0f3b28
}

.container{max-width:820px;width:100%}

.card{
background:#fff;border-radius:40px;
padding:28px;box-shadow:0 20px 60px rgba(15,59,40,.12);
transition:.25s
}

.card:hover{transform:translateY(-3px)}

.title{font-size:28px;font-weight:800;text-align:center}
.tagline{text-align:center;margin-top:6px;color:#1e8b4c}

.input-area{display:flex;gap:10px;margin-top:20px}
.input-box{
flex:1;display:flex;align-items:center;
border:2px solid #e2f1ea;border-radius:14px;padding:12px
}
.input-box input{border:none;outline:none;flex:1}

.btn{
background:#1e8b4c;color:#fff;border:none;
padding:14px 20px;border-radius:14px;
cursor:pointer;font-weight:700
}

.formats{display:flex;gap:10px;margin-top:16px}
.format{
flex:1;border:2px solid #1e8b4c;border-radius:12px;
padding:10px;font-weight:700;background:#fff;cursor:pointer
}
.format.active{background:#1e8b4c;color:#fff}

.result{display:none;margin-top:20px;padding:18px;border-radius:18px;background:#f6fbf8}

.download-btn{
width:100%;margin-top:12px;padding:14px;
border:none;border-radius:14px;background:#0f3b28;
color:#fff;font-weight:800;cursor:pointer
}

.progress{height:6px;background:#e2f1ea;border-radius:3px;margin-top:10px;overflow:hidden;display:none}
.bar{height:100%;width:0;background:#1e8b4c}

.toast{
position:fixed;top:20px;left:50%;
transform:translateX(-50%);
background:#0f3b28;color:#fff;
padding:10px 16px;border-radius:30px;
font-size:13px
}
</style>
</head>

<body>
<div class="container">
<div class="card">

<div class="title">TikTok Downloader by nata~</div>
<div class="tagline">Cepat, bersih, tanpa watermark</div>

<div class="input-area">
<div class="input-box">
<input id="url" placeholder="Tempel link TikTok">
</div>
<button class="btn" id="go">Ambil</button>
</div>

<div class="formats">
<button class="format active" data="mp4">MP4</button>
<button class="format" data="mp3">MP3</button>
</div>

<div class="result" id="result">
<h3 id="name">video.mp4</h3>
<div class="progress" id="progress"><div class="bar" id="bar"></div></div>
<button class="download-btn" id="download">DOWNLOAD</button>
</div>

</div>
</div>

<script>
let format="mp4"
let data=null

const APIS=[
url=>"https://api.tikwm.com/video/info?url="+encodeURIComponent(url),
url=>"https://tikdown.org/api/ajaxSearch?url="+encodeURIComponent(url),
url=>"https://ttdownloader.com/req/?url="+encodeURIComponent(url)
]

function toast(msg){
const t=document.createElement("div")
t.className="toast"
t.innerText=msg
document.body.appendChild(t)
setTimeout(()=>t.remove(),3000)
}

async function fetchWithTimeout(u,ms=8000){
const c=new AbortController()
setTimeout(()=>c.abort(),ms)
const r=await fetch(u,{signal:c.signal})
if(!r.ok)throw Error("http")
return r.json()
}

async function getVideo(url){
for(const api of APIS){
try{
const j=await fetchWithTimeout(api(url))

if(j.data?.play){
return{video:j.data.play,audio:j.data.music,id:j.data.id}
}

if(j.links?.nowm){
return{video:j.links.nowm,audio:j.links.music,id:"tt"}
}

}catch(e){}
}
throw Error("semua api gagal")
}

function progressStart(){document.getElementById("progress").style.display="block"}
function progress(v){document.getElementById("bar").style.width=v+"%"}
function progressEnd(){
setTimeout(()=>{
document.getElementById("progress").style.display="none"
progress(0)
},500)
}

function download(url,name){
return new Promise((res,rej)=>{
const x=new XMLHttpRequest()
x.open("GET",url)
x.responseType="blob"

x.onprogress=e=>{
if(e.lengthComputable)progress((e.loaded/e.total)*100)
}

x.onload=()=>{
if(x.status===200){
const a=document.createElement("a")
a.href=URL.createObjectURL(x.response)
a.download=name
a.click()
progressEnd()
res()
}else rej()
}

x.onerror=rej
progressStart()
x.send()
})
}

document.querySelectorAll(".format").forEach(b=>{
b.onclick=()=>{
document.querySelectorAll(".format").forEach(x=>x.classList.remove("active"))
b.classList.add("active")
format=b.getAttribute("data")
}
})

document.getElementById("go").onclick=async()=>{
const url=document.getElementById("url").value
if(!url.includes("tiktok"))return toast("link tidak valid")

toast("mengambil video...")

try{
data=await getVideo(url)
document.getElementById("name").innerText="tiktok_"+data.id+"."+format
document.getElementById("result").style.display="block"

const u=format==="mp4"?data.video:data.audio
await download(u,"tiktok_"+data.id+"."+format)

toast("download mulai")
}catch{
toast("gagal ambil video")
}
}

document.getElementById("download").onclick=async()=>{
if(!data)return toast("ambil dulu")
const u=format==="mp4"?data.video:data.audio
await download(u,"tiktok_"+data.id+"."+format)
}
</script>
</body>
</html>
