<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TikTok Downloader by nata~</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,Segoe UI,Roboto}
body{background:linear-gradient(135deg,#f4faf7,#e8f5ee);display:flex;justify-content:center;padding:20px;color:#0f3b28}
.container{max-width:860px;width:100%}
.card{background:#fff;border-radius:52px;padding:30px;box-shadow:0 20px 60px rgba(15,59,40,0.12);transition:.3s}
.card:hover{transform:translateY(-4px);box-shadow:0 25px 70px rgba(15,59,40,0.16)}

.profile{text-align:center;margin-bottom:20px}
.profile img{width:120px;height:120px;border-radius:24px;object-fit:cover;background:#e6f2ec}
.title{font-size:30px;font-weight:800;margin-top:12px}
.tagline{margin-top:6px;color:#1e8b4c;font-weight:500}

.pills{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:20px 0}
.pill{background:#e9f6ef;padding:8px 14px;border-radius:999px;font-size:13px;color:#0f3b28;font-weight:600}

.input-area{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
.input-box{flex:1;display:flex;align-items:center;background:#fff;border:2px solid #e2f1ea;border-radius:16px;padding:12px;transition:.2s}
.input-box:focus-within{border-color:#1e8b4c;box-shadow:0 0 0 4px rgba(30,139,76,0.08)}
.input-box i{margin-right:10px}
.input-box input{border:none;outline:none;flex:1;font-size:15px}

.btn{background:linear-gradient(135deg,#0f3b28,#1e8b4c);color:#fff;border:none;padding:14px 22px;border-radius:16px;cursor:pointer;font-weight:700;transition:.25s;display:flex;align-items:center;gap:8px}
.btn:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(30,139,76,0.25)}
.btn:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}

.formats{display:flex;gap:12px;margin-top:18px}
.format{flex:1;padding:12px;border-radius:14px;border:2px solid #1e8b4c;background:#fff;cursor:pointer;font-weight:700;transition:.2s}
.format.active{background:#1e8b4c;color:#fff;box-shadow:0 6px 18px rgba(30,139,76,0.25)}

.steps{display:flex;flex-wrap:wrap;gap:14px;margin:24px 0}
.step{flex:1;min-width:150px;background:#f1f8f4;padding:14px;border-radius:18px;font-size:13px;font-weight:500}
.step span{display:inline-flex;width:24px;height:24px;border-radius:50%;background:#1e8b4c;color:#fff;align-items:center;justify-content:center;margin-right:6px;font-size:12px}

.result{display:none;margin-top:16px;padding:20px;border-radius:22px;background:#f6fbf8;animation:fade .4s ease}
@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

.result h3{margin-bottom:6px}
.meta{font-size:13px;margin-bottom:12px;color:#3b6b55}
.download-btn{width:100%;padding:16px;border:none;border-radius:16px;background:linear-gradient(135deg,#1e8b4c,#0f3b28);color:#fff;font-weight:800;cursor:pointer;transition:.25s;font-size:15px}
.download-btn:hover{transform:scale(1.03);box-shadow:0 10px 30px rgba(30,139,76,0.35)}
.download-btn.downloading{opacity:0.8;cursor:progress;transform:none}
.download-progress{margin-top:10px;height:6px;background:#e2f1ea;border-radius:3px;overflow:hidden;display:none}
.download-progress.active{display:block}
.progress-bar{height:100%;width:0%;background:#1e8b4c;transition:width 0.3s ease}

footer{text-align:center;margin-top:20px;font-size:13px;color:#3b6b55}

@media(max-width:600px){.title{font-size:24px}.btn{width:100%;justify-content:center}}
</style></head><body>
<div class="container">
<div class="card"><div class="profile">
<img src="nata.jpg" onerror="this.style.display='none';document.getElementById('fallback').style.display='flex'">
<div id="fallback" style="display:none;width:120px;height:120px;border-radius:24px;background:#1e8b4c;color:#fff;align-items:center;justify-content:center;font-size:44px;margin:auto">N</div>
<div class="title">TikTok Downloader by nata~</div>
<div class="tagline"><i class="fa-solid fa-face-smile"></i> Cepat, bersih, tanpa watermark</div>
</div><div class="pills">
<div class="pill">FAST</div>
<div class="pill">SECURE</div>
<div class="pill">NO WM</div>
<div class="pill">MP3/MP4</div>
</div><div class="input-area">
<div class="input-box">
<i class="fa-brands fa-tiktok"></i>
<input id="url" placeholder="Tempel link TikTok di sini">
</div>
<button class="btn" id="processBtn"><i class="fa-solid fa-bolt"></i> Ambil Video</button>
</div><div class="formats">
<button class="format active" data-type="mp4">MP4</button>
<button class="format" data-type="mp3">MP3</button>
</div><div class="steps">
<div class="step"><span>1</span>Copy link TikTok</div>
<div class="step"><span>2</span>Tempel lalu ambil</div>
<div class="step"><span>3</span>Auto download</div>
</div><div class="result" id="result">
<h3 id="fileName">tiktok_video.mp4</h3>
<div class="meta" id="meta">Siap diunduh otomatis</div>
<div class="download-progress" id="progressContainer">
<div class="progress-bar" id="progressBar"></div>
</div>
<button class="download-btn" id="downloadBtn">DOWNLOAD SEKARANG</button>
</div></div><footer>Â© 2025 nata~ <i class="fa-solid fa-heart"></i> all rights reversed</footer>
</div>
<script>
let currentFormat="mp4"
let videoData=null

// Optimasi API dengan Promise.race untuk kecepatan maksimal
const APIs=[
url => `https://api.tikwm.com/video/info?url=${encodeURIComponent(url)}`,
url => `https://tikwm.com/api/?url=${encodeURIComponent(url)}`
]

// Fungsi download dengan progress bar real-time
function downloadWithProgress(url, filename) {
return new Promise((resolve, reject) => {
const xhr = new XMLHttpRequest();
xhr.open('GET', url, true);
xhr.responseType = 'blob';

// Update progress bar
xhr.onprogress = (e) => {
if (e.lengthComputable) {
const percentComplete = (e.loaded / e.total) * 100;
document.getElementById('progressBar').style.width = percentComplete + '%';
document.getElementById('progressContainer').classList.add('active');
}
};

xhr.onload = function() {
if (this.status === 200) {
const blob = this.response;
// Buat download otomatis
const link = document.createElement('a');
link.href = URL.createObjectURL(blob);
link.download = filename;
link.click();

// Bersihkan dan reset progress
setTimeout(() => {
URL.revokeObjectURL(link.href);
document.getElementById('progressContainer').classList.remove('active');
document.getElementById('progressBar').style.width = '0%';
}, 100);
resolve();
} else {
reject(new Error('Download failed'));
}
};

xhr.onerror = () => reject(new Error('Network error'));
xhr.send();
});
}

function setFormats(){
document.querySelectorAll(".format").forEach(btn=>{
btn.onclick=()=>{
document.querySelectorAll(".format").forEach(b=>b.classList.remove("active"))
btn.classList.add("active")
currentFormat=btn.dataset.type
updatePreview()
}
})
}
setFormats()

document.getElementById("url").addEventListener("keypress",e=>{if(e.key==="Enter")process()})

document.getElementById("processBtn").onclick=process

// Optimasi fetch dengan Promise.race dan timeout
async function fetchFromAPIs(link){
const fetchPromises = APIs.map(async (build) => {
try {
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 5000); // Timeout 5s

const response = await fetch(build(link), {
signal: controller.signal,
headers: {
'Accept': 'application/json'
}
});

clearTimeout(timeoutId);

if (!response.ok) throw new Error('HTTP error');
const json = await response.json();
if (json?.data?.play || json?.data?.music) return json.data;
} catch (e) {
console.warn('API failed:', e);
}
return null;
});

// Race semua API, ambil yang pertama sukses
const result = await Promise.race([
Promise.all(fetchPromises).then(results => results.find(r => r !== null)),
new Promise((_, reject) => setTimeout(() => reject(new Error('All APIs timeout')), 6000))
]);

if (!result) throw new Error('No valid response from APIs');
return result;
}

async function process(){
const link=document.getElementById("url").value.trim()
if(!link.includes("tiktok")){alert("Link tidak valid");return}

const btn=document.getElementById("processBtn")
btn.disabled=true
btn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Memproses...'

try{
videoData=await fetchFromAPIs(link)
updatePreview()
document.getElementById("result").style.display="block"

const fileName=document.getElementById("fileName").innerText
const url=currentFormat==="mp4"?videoData.play:videoData.music

if(url) {
// Reset progress
document.getElementById('progressContainer').classList.remove('active');
document.getElementById('progressBar').style.width = '0%';

// Download dengan progress
await downloadWithProgress(url, fileName);
}

}catch(e){
alert("Gagal mengambil data. Coba lagi. Error: " + e.message)
}finally{
btn.disabled=false
btn.innerHTML='<i class="fa-solid fa-bolt"></i> Ambil Video'
}
}

function updatePreview(){
if(!videoData) return
const id=videoData.id||"video"
const ext=currentFormat==="mp4"?"mp4":"mp3"

document.getElementById("fileName").innerText=`tiktok_${id}_${currentFormat}.${ext}`

document.getElementById("meta").innerText=currentFormat==="mp4"?"Video tanpa watermark siap diunduh":"Audio asli siap diunduh"
}

document.getElementById("downloadBtn").onclick=async ()=>{
if(!videoData) return
const btn = document.getElementById("downloadBtn")
const fileName=document.getElementById("fileName").innerText
const url=currentFormat==="mp4"?videoData.play:videoData.music

if(url) {
btn.classList.add('downloading')
btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Mengunduh...'
btn.disabled = true

try {
// Reset progress
document.getElementById('progressContainer').classList.remove('active');
document.getElementById('progressBar').style.width = '0%';

// Download dengan progress
await downloadWithProgress(url, fileName);
} catch (error) {
alert('Gagal mengunduh: ' + error.message);
} finally {
btn.classList.remove('downloading')
btn.innerHTML = 'DOWNLOAD SEKARANG'
btn.disabled = false
}
}
}
</script></body>
</html>
